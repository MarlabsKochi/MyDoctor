<%= form_for @appointment do |f| %>

  <% if @appointment.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(@appointment.errors.count, "error") %> prohibited this appointment from being saved:</h2>

      <ul>
      <% @appointment.errors.full_messages.each do |message| %>
        <li><%= message %></li>
      <% end %>
      </ul>
    </div>
  <% end %>

  <div class="field">
    <%= f.label :date %><br>
    <%= f.text_field :date, class:'datepickerfield' %>
  </div>

  <div id="appointment-time"></div>

  <div id="loading-image" style="display:none;"><%=image_tag 'ajax-loader.gif'%></div>

  <%= hidden_field_tag 'doctor_id', params[:doctor_id] %>

  <div class="actions">
    <%= f.submit "Create", :class => 'button right' %>
  </div>

<%end%>

<script>
  $(document).ready(function () {
    $('.datepickerfield').datepicker({format: "dd/mm/yyyy", autoclose : true}).on("changeDate", function(e) {
    	appointment_date = ($('#appointment_date').val());
      $('#loading-image').show();
    	$.ajax({
          method: "get",
          url: "appointments/time_selector",
          data: { date: appointment_date,
                  doctor_id: "<%=params[:doctor_id]%>"
                }     
      	})
        .done(function( data ) {
          $('#loading-image').hide();
          $("#appointment-time").html(data)
        });
    });
  });
</script>